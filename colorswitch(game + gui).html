<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Color Switch Game</title>
  <style>
    body, html { margin: 0; padding: 0; overflow: hidden; }
    canvas { background-color: #f0f0f0; display: block; margin: auto; }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <script>
    // Set up canvas
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = 400;
    canvas.height = 600;

    // Game variables
    let ball = { x: 200, y: 300, radius: 10, color: "purple", dy: 0 };
    let gravity = 0.25;
    let jump = -5;
    let score = 0;
    let colors = ["purple", "yellow", "blue", "pink"];
    let obstacles = [];
    let colorIndex = 0;
    let gameRunning = true;

    // Obstacle class
    class Obstacle {
      constructor(y) {
        this.y = y;
        this.rotation = 0;
      }

      draw() {
        ctx.save();
        ctx.translate(canvas.width / 2, this.y);
        ctx.rotate(this.rotation);

        // Draw the colored arcs
        for (let i = 0; i < 4; i++) {
          ctx.beginPath();
          ctx.strokeStyle = colors[i];
          ctx.lineWidth = 15;
          ctx.arc(0, 0, 80, (i * Math.PI) / 2, ((i + 1) * Math.PI) / 2);
          ctx.stroke();
        }
        ctx.restore();
      }

      update() {
        this.rotation += 0.02;
        this.y += 1;
      }
    }

    function createObstacle() {
      let newObstacle = new Obstacle(-100); // Start above the screen
      obstacles.push(newObstacle);
    }

    function drawBall() {
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      ctx.fillStyle = ball.color;
      ctx.fill();
    }

    function switchBallColor() {
      colorIndex = (colorIndex + 1) % colors.length;
      ball.color = colors[colorIndex];
    }

    function checkCollision(obstacle) {
      if (ball.y - ball.radius < obstacle.y + 80 && ball.y + ball.radius > obstacle.y - 80) {
        let segment = Math.floor(((obstacle.rotation % (Math.PI * 2)) + Math.PI / 4) / (Math.PI / 2)) % 4;
        if (colors[segment] !== ball.color) {
          // Stop the game
          gameRunning = false;
          alert("Game Over! Score: " + score);
        } else if (ball.y < obstacle.y) {
          score++;
          switchBallColor();
          createObstacle();
        }
      }
    }

    function gameLoop() {
      if (!gameRunning) return; // Stop the game if gameRunning is false

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Update ball position
      ball.dy += gravity;
      ball.y += ball.dy;

      if (ball.y + ball.radius > canvas.height) {
        ball.dy = jump;  // Reset jump when it hits the ground
      }

      drawBall();

      // Update and draw obstacles
      obstacles.forEach((obstacle, index) => {
        obstacle.draw();
        obstacle.update();
        checkCollision(obstacle);

        // Remove obstacles that have moved off-screen
        if (obstacle.y > canvas.height + 100) {
          obstacles.splice(index, 1);
        }
      });

      ctx.fillStyle = "#333";
      ctx.font = "20px Arial";
      ctx.fillText("Score: " + score, 10, 30);

      requestAnimationFrame(gameLoop);
    }

    // Start the game
    createObstacle();
    gameLoop();

    // Jump on click
    document.addEventListener("click", () => {
      if (gameRunning) {
        ball.dy = jump;
      }
    });
  </script>
</body>
</html>
